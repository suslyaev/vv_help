# Система поддержки поставщиков ВкусВилл

Система для учета обращений поставщиков, их классификации, отслеживания количества, времени обработки и управления очередью дел.

## Возможности системы

### Основные функции
- **Учет обращений** - создание, редактирование и отслеживание обращений поставщиков
- **Классификация** - двухуровневая система категорий с настраиваемыми SLA
- **Управление клиентами** - база поставщиков с контактной информацией
- **Статусная модель** - отслеживание жизненного цикла обращений
- **Аудит** - полная история изменений с возможностью корректировки времени
- **Очередь дел** - распределение нагрузки между сотрудниками
- **Контрольные сроки** - настраиваемые SLA для каждой категории
- **Шаблоны решений** - быстрые ответы для типовых вопросов

### Дополнительные возможности
- **Поиск и фильтрация** - гибкие фильтры по всем параметрам
- **Приоритеты** - 4 уровня приоритета обращений
- **Комментарии** - внутренние и внешние комментарии
- **Вложения** - поддержка файлов к обращениям
- **Интеграция с ботами** - готовность к подключению Telegram бота
- **Многопользовательская работа** - поддержка команды сотрудников

## Установка и запуск

### Требования
- Python 3.8+
- Django 5.2+

### Установка
```bash
# Клонирование репозитория
git clone <repository_url>
cd vv_help_system

# Создание виртуального окружения
python -m venv env
source env/bin/activate  # Linux/Mac
# или
env\Scripts\activate  # Windows

# Установка зависимостей
pip install -r requirements.txt

# Применение миграций
python manage.py migrate

# Создание суперпользователя
python manage.py createsuperuser

# Настройка переменных окружения
cp .env.example .env
# Отредактируйте .env файл, указав ваш TELEGRAM_BOT_TOKEN

# Заполнение начальными данными
python manage.py init_data

# Запуск сервера
python manage.py runserver

# Запуск Telegram бота (в отдельном терминале)
python manage.py bot
```

### Доступ к системе
- **Веб-интерфейс**: http://localhost:8000/tickets/
- **Админка**: http://localhost:8000/admin/

## Структура системы

### Модели данных

#### Category (Категории)
- Двухуровневая иерархия категорий
- Настраиваемые SLA для каждой категории
- Описания и статус активности

#### Client (Клиенты)
- Информация о поставщиках
- Контактные данные
- Внешние ID для интеграции
- Статистика обращений

#### Ticket (Обращения)
- Основная информация об обращении
- Связь с клиентом и категорией
- Статус и исполнитель
- Корректируемые временные метки
- Решение и заметки

#### TicketStatus (Статусы)
- Настраиваемые статусы с цветовой кодировкой
- Флаги для финальных статусов и статусов "в работе"
- Порядок отображения

#### TicketAudit (Аудит)
- Полная история изменений
- Типы действий и комментарии
- Возможность корректировки времени

#### TicketComment (Комментарии)
- Внутренние и внешние комментарии
- История обсуждений

#### TicketTemplate (Шаблоны)
- Готовые шаблоны решений
- Привязка к категориям
- Поддержка переменных

### Интерфейс

#### Дашборд
- Общая статистика по обращениям
- Последние обращения
- Статистика по статусам и категориям
- Быстрые действия

#### Список обращений
- Таблица с фильтрацией и поиском
- Индикаторы SLA и приоритетов
- Массовые действия
- Пагинация

#### Детальная страница обращения
- Полная информация об обращении
- История комментариев
- Форма добавления комментариев
- Информация о SLA и времени

#### Очередь дел
- Не назначенные обращения
- Мои обращения
- Просроченные обращения
- Быстрые действия

#### Управление клиентами
- Список клиентов с поиском
- Детальная информация
- История обращений клиента

## Настройка SLA

SLA (Service Level Agreement) настраивается для каждой категории:

- **Изменение цен**: 1 час
- **Качество товара**: 1 час  
- **Корректировка данных**: 2 часа
- **Поставки**: 2 часа
- **Карточки продуктов**: 4 часа
- **Документооборот**: 8-48 часов

## Работа в команде

### Роли пользователей
- **Администратор** - полный доступ ко всем функциям
- **Менеджер поддержки** - работа с обращениями
- **Оператор** - создание и базовое управление обращениями

### Рабочий процесс
1. **Создание обращения** - автоматически или вручную
2. **Назначение исполнителя** - автоматически или вручную
3. **Взятие в работу** - исполнитель берет обращение
4. **Решение** - заполнение решения и закрытие
5. **Аудит** - отслеживание всех изменений

## Интеграция с Telegram ботом

Система включает готовый Telegram бот для создания обращений:

### Настройка бота
1. Создайте бота через @BotFather в Telegram
2. Получите токен бота
3. Укажите токен в файле `.env`:
   ```
   TELEGRAM_BOT_TOKEN=your_bot_token_here
   ```

### Настройка пользователей
1. В админке Django перейдите в раздел "Пользователи"
2. Откройте профиль пользователя
3. В разделе "Профиль Telegram" укажите:
   - `Telegram User ID` - ID пользователя в Telegram
   - `Может использовать Telegram бота` - поставьте галочку

### Запуск бота
```bash
python manage.py bot
```

### Функциональность бота
- **Пересылка сообщений**: Пользователи пересылают сообщения от клиентов
- **Автоматическое создание обращений**: Бот создает обращения с темой "Создано из Telegram"
- **Идентификация клиентов**: По `external_id` из пересланного сообщения
- **Сохранение времени**: Использует `forward_date` как время создания обращения
- **Категория по умолчанию**: "Обращения от поставщиков"
- **Авторизация**: Только пользователи с настроенным профилем Telegram

## Расширение системы

### Добавление новых категорий
```python
# В админке Django или через код
Category.objects.create(
    name='Новая категория',
    parent=parent_category,  # или None для корневой
    sla_hours=24,
    description='Описание категории'
)
```

### Добавление новых статусов
```python
TicketStatus.objects.create(
    name='Новый статус',
    color='#ff0000',
    is_working=False,
    is_final=False,
    order=10
)
```

### Создание шаблонов решений
```python
TicketTemplate.objects.create(
    name='Шаблон ответа',
    category=category,
    title_template='Ответ на обращение #{ticket_id}',
    content_template='Содержание ответа...',
    is_active=True
)
```

## Мониторинг и отчетность

### Ключевые метрики
- Время обработки обращений
- Соблюдение SLA
- Нагрузка на исполнителей
- Популярные категории
- Статистика по клиентам

### Экспорт данных
- Все данные доступны через Django Admin
- Возможность создания кастомных отчетов
- API для интеграции с внешними системами

## Поддержка

Для получения поддержки или предложений по улучшению системы обращайтесь к команде разработки.

## Лицензия

Внутренняя система ВкусВилл. Все права защищены.
